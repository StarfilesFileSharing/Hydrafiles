<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Hydrafiles</title>
    <link rel="stylesheet" href="index.css" />
  </head>
  <body>
    <h1>Hydrafiles</h1>
    <h2>Node Status: <span id="status">N/A</span></h2>
    <div>
      <input type="text" id="hash" placeholder="Hash" />
      <button id="download">Download</button>
    </div>
    <h2>Files</h2>
    <table id="files"></table>
    <script>
    window.addEventListener('DOMContentLoaded', () => {
      window.electronAPI.receive('config', (config) => {
          window.config = config

          const status = document.getElementById('status');
          fetch(`http://${window.config.public_hostname}/status`)
            .then(response => response.json())
            .then(data => {
              if(data.status) {
                status.innerHTML = 'Online';
                status.style.color = 'green';
              } else {
                status.innerHTML = 'Offline';
                status.style.color = 'red';
              }
            }).catch(() => {
              status.innerHTML = 'Offline';
              status.style.color = 'red';
            });
      });
      window.electronAPI.receive('files', (files) => {
        if(JSON.stringify(files) === JSON.stringify(window.files)) return;
        window.files = files;
        const table = document.getElementById('files');
        table.innerHTML = `
          <tr>
            <th>Hash</th>
            <th>Size</th>
          </tr>
        `;
        for(const file of files) {
          const row = table.insertRow();
          const hashCell = row.insertCell(0);
          const sizeCell = row.insertCell(1);
          hashCell.textContent = file.hash;
          sizeCell.textContent = file.size + ' bytes';
        };
      });

      document.getElementById('download').addEventListener('click', () => {
        const hash = document.getElementById('hash').value;
        fetch(`http://${window.config.public_hostname}/download/${hash}`)
          .then(response => response.blob())
          .then(blob => {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = hash;
            a.click();
            URL.revokeObjectURL(url);
          });
      });
      
      // window.electronAPI.send('message', 'Hello from renderer');
    });
  </script>
  </body>
</html>
